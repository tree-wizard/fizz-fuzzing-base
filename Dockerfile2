# Base Fizz Dockerfile

FROM ubuntu:latest
RUN apt-get update --fix-missing
RUN apt-get --yes install git tree apt-utils
RUN apt-get update
RUN apt-get --yes install wget vim git tree gnupg1 zlib1g-dev make

RUN wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key > key 
RUN apt-key add key
RUN apt-get update
RUN apt-get --yes install clang-7 lldb-7 lld-7 libfuzzer-7-dev

ENV CC clang-7
ENV CXX clang++-7

RUN apt-get install --yes g++  gperf unzip  cmake     libboost-all-dev     libevent-dev     libdouble-conversion-dev     libgoogle-glog-dev     libgflags-dev     libiberty-dev     liblz4-dev     liblzma-dev     libsnappy-dev     make     zlib1g-dev     binutils-dev     libjemalloc-dev     libssl-dev     pkg-config     libsodium-dev autoconf autoconf-archive



#download repos
RUN git clone https://github.com/facebook/proxygen /root/proxygen/
RUN git clone https://github.com/facebook/folly /root/proxygen/proxygen/folly


RUN rm /root/proxygen/proxygen/deps-centos.sh


#fizz
RUN git clone https://github.com/facebookincubator/fizz /root/proxygen/proxygen/fizz

#Wangle
RUN git clone https://github.com/facebook/wangle /root/proxygen/proxygen/wangle

#replace files
RUN git clone https://github.com/xxyyx/macaddr-folly /root/macaddr-folly

RUN chmod +777 /root/macaddr-folly/deps.sh
RUN mv /root/macaddr-folly/deps.sh /root/proxygen/proxygen/deps.sh

RUN mv /root/folly-uri/replacements/FollyConfigChecks.cmake /root/proxygen/proxygen/folly/CMake/FollyConfigChecks.cmake

RUN mv /root/folly-uri/replacements/Subprocess.cpp /root/proxygen/proxygen/folly/folly/Subprocess.cpp

RUN mv /root/folly-uri/replacements/CMakeLists.txt /root/proxygen/proxygen/folly/folly/CMakeLists.txt


RUN mv /root/folly-uri/replacements/malloc.h /usr/include/malloc.h

#edit these files
#vim /usr/include/malloc.h +134
#   72  vim /usr/include/malloc.h +64